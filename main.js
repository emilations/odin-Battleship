(()=>{"use strict";let e={2:"Patrol Boat",3:"Submarine",3:"Destroyer",4:"Battleship",5:"Carrier"};function t(){let t=1,r=[],i=Array(10).fill("0").map((()=>Array(10).fill("0")));return{shipList:r,getPrivateGrid:function(){return JSON.parse(JSON.stringify(i))},getPublicGrid:function(){let e=i.map((e=>e.map((e=>"H"==e[0]||"M"==e[0]?e[0]:"0"))));return JSON.parse(JSON.stringify(e))},placeShip:function(a,n){if("x"==a.dir&&a.x+n>10)throw new Error("Outside of grid");if("y"==a.dir&&a.y+n>10)throw new Error("Outside of grid");if("x"==a.dir){for(let e=0;e<n;e++)if("S"==i[a.x+e][a.y][0])throw new Error("Interference")}else if("y"==a.dir)for(let e=0;e<n;e++)if("S"==i[a.x][a.y+e][0])throw new Error("Interference");let l=`S${t}`;t++;let o=function(t,r){if(!t||t>5||t<=1)throw new Error("Length must be between 2 and 5");let i=e[t],a=Array(t).fill(!0),n=Array();return{shipId:r,type:i,shipLength:t,getFuselage:function(){return[...a]},setCoor:function(e){n.push({x:e.x,y:e.y})},getCoor:function(){return[...n]},hit:function(e){let t=!1;return n.forEach(((r,i)=>{JSON.stringify(r)==JSON.stringify(e)&&(a[i]=!1,t=!0)})),t},isSunk:function(){return!!a.every((e=>!e))}}}(n,l);if(r.push(o),"x"==a.dir)for(let e=0;e<n;e++)i[a.x+e][a.y]=l,o.setCoor({x:a.x+e,y:a.y});else if("y"==a.dir)for(let e=0;e<n;e++)i[a.x][a.y+e]=l,o.setCoor({x:a.x,y:a.y+e});return o},attack:function(e){if(e.x<0||e.x>9||e.y<0||e.y>9)throw new Error("Outside of grid");return"S"==i[e.x][e.y][0]?(i[e.x][e.y]=i[e.x][e.y].replace("S","H"),r.find(((t,r,i)=>t.hit(e))),"Hit"):"H"==i[e.x][e.y][0]||"M"==i[e.x][e.y][0]?"Already hit":(i[e.x][e.y]="M","Miss")},isAllHit:function(){return r.every((e=>e.isSunk()))}}}let r=function(e){if("Human"==e)return{type:"Human",score:0,gameboard:t(),placeShip:function(e,t){return this.gameboard.placeShip(e,t)},receiveHit:function(e){return this.gameboard.attack(e)}};if("Computer"==e){let e=t();return{type:"Computer",score:0,gameboard:e,placeShip:function(t,r){if(t)return this.gameboard.placeShip(t,r);let i=[5,4,3,3,2],a=0;do{let t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),n=0==Math.floor(2*Math.random())?"x":"y";try{e.placeShip({x:t,y:r,dir:n},i[a])}catch(e){a--}a++}while(a<5)},receiveHit:function(e){return this.gameboard.attack(e)},attack:function(){let e=JSON.parse(JSON.stringify(i.gameboard.getPublicGrid()));if(i.gameboard.getPublicGrid().every(((t,r)=>t.every(((t,a)=>"H"!=t||[{x:r+1,y:a},{x:r-1,y:a},{x:r,y:a+1},{x:r,y:a-1}].every((t=>!(t.x>=0&&t.x<10&&t.y>=0&&t.y<10&&"0"==e[t.x][t.y]&&(i.receiveHit(t),n.round(),1))))))))){let e=!1;do{let t={x:Math.floor(10*Math.random()),y:Math.floor(10*Math.random())},r=/Already hit/;try{let a=i.receiveHit(t);e=!!r.test(a)}catch(t){e=!0}}while(e);n.round()}}}}throw new Error("Unsupported type")},i=r("Human"),a=r("Computer"),n=function(){let e="Human",t=function(){l.configure("placeShip"),l.cacheDOM(),l.rotateButton("on"),l.startHighlightCell("placeShip"),l.registerPlaceShipCell()},n=function(){if(c())return l.refresh("populate"),void s();"Human"==e?e="Human"==e?"Computer":"Human":"Computer"==e&&(e="Human"==e?"Computer":"Human",o(""),a.attack(),l.refresh("populate"))},c=function(){return!(!i.gameboard.isAllHit()&&!a.gameboard.isAllHit())},s=function(){e="Human"==e?"Computer":"Human",l.refresh("reset"),o(`${e} Won`)};return{initiateGame:function(){a=r("Computer"),i=r("Human"),t()},startGame:function(){l.configure("gameOn"),l.refresh("reset"),l.refresh("populate"),o("Place your hits on enemy waters"),a.placeShip(),l.cacheDOM(),l.attackListenerCell(),l.startHighlightCell("gameOn"),n()},endGame:s,placeShip:t,getGrid:function(e){return"human"==e?JSON.parse(JSON.stringify(i.gameboard.getPrivateGrid())):"computer"==e?JSON.parse(JSON.stringify(a.gameboard.getPublicGrid())):void 0},round:n}}(),l=function(){let e,t,r={y:0,x:0,dir:"x"},c=["Place your carrier captain","Place your battleship captain","Place your destroyer captain","Place your submarine captain","Place your patrol boat captain"],s=[5,4,3,3,2],d=0,u=function(e){r.x=parseInt(e.target.id[12]),r.y=parseInt(e.target.id[6])};function h(){a.receiveHit({x:r.x,y:r.y}),f("populate"),l.refresh("removeListener"),n.round()}let f=function(n){if("reset"==n){let e=document.querySelector(".grid-left > .grid-layout"),t=e.cloneNode(!0);e.parentNode.replaceChild(t,e);let r=document.querySelector(".grid-right > .grid-layout"),i=r.cloneNode(!0);r.parentNode.replaceChild(i,r)}else if("populate"==n)i.gameboard.getPrivateGrid().forEach(((t,r)=>{t.forEach(((t,i)=>{if("S"==t[0]){let t=parseInt(r)+10*parseInt(i);e[t].classList.add("cell-ship-present")}else if("H"==t[0]){let t=parseInt(r)+10*parseInt(i);e[t].classList.add("cell-ship-hit")}else if("M"==t[0]){let t=parseInt(r)+10*parseInt(i);e[t].classList.add("cell-ship-missed")}}))})),a.gameboard.getPublicGrid().forEach(((e,r)=>{e.forEach(((e,i)=>{let a=parseInt(r)+10*parseInt(i);"H"==e[0]?t[a].classList.add("cell-ship-hit"):"M"==e[0]&&t[a].classList.add("cell-ship-missed")}))}));else if("highlight"==n)e.forEach((e=>e.classList.remove("cell-hover","cell-hover-outBound","cell-ship-highlight-interference","cell-hover-attack"))),t.forEach((e=>e.classList.remove("cell-hover","cell-hover-outBound","cell-ship-highlight-interference","cell-hover-attack")));else if("removeListener"==n){let e=parseInt(r.x)+10*parseInt(r.y);t[e].removeEventListener("click",h)}},p=function(){r.dir="x"==r.dir?"y":"x",f("highlight")};return{cacheDOM:function(){e=document.querySelectorAll(".grid-left > .grid-layout > .cell-p1"),t=document.querySelectorAll(".grid-right > .grid-layout > .cell-p1")},configure:function(e){let t=document.querySelector(".grid-left"),r=document.querySelector(".grid-right");"placeShip"==e?(o("","add"),o(`${c[d]}`),t.classList.add("grid-middle"),r.classList.add("grid-hide")):"gameOn"==e&&(o("","del"),t.classList.remove("grid-middle"),r.classList.remove("grid-hide"))},startHighlightCell:function(a){if("placeShip"==a){function n(t){o(`${c[d]}`),f("highlight");let a=parseInt(r.x)+10*parseInt(r.y);if("x"==r.dir&&s[d]+parseInt(r.x)>10||"y"==r.dir&&s[d]+parseInt(r.y)>10)return void e[a].classList.add("cell-hover-outBound");let n=i.gameboard.getPrivateGrid();if("x"==r.dir)for(let t=0;t<s[d];t++)"S"==n[r.x+t][r.y][0]&&e[a+t].classList.add("cell-ship-highlight-interference");else if("y"==r.dir)for(let t=0;t<s[d];t++)"S"==n[r.x][r.y+t][0]&&e[a+10*t].classList.add("cell-ship-highlight-interference");if("x"==r.dir)for(let t=0;t<s[d];t++)e[a+t].classList.add("cell-hover");else if("y"==r.dir)for(let t=0;t<s[d];t++)e[a+10*t].classList.add("cell-hover")}e.forEach((e=>{e.addEventListener("mouseover",u),e.addEventListener("mouseover",n)}))}else if("gameOn"==a){function l(e){f("highlight");let i=parseInt(r.x)+10*parseInt(r.y);t[i].classList.add("cell-hover-attack")}t.forEach((e=>{e.addEventListener("mouseover",l)}))}},rotateButton:function(e){"on"==e&&document.querySelector(".message > button").addEventListener("click",p)},refresh:f,registerPlaceShipCell:function(){function t(e){let t=i.gameboard.getPrivateGrid();if("x"==r.dir){for(let e=0;e<s[d];e++)if("S"==t[r.x+e][r.y][0])return}else if("y"==r.dir)for(let e=0;e<s[d];e++)if("S"==t[r.x][r.y+e][0])return;o(`${c[d]}`),i.placeShip(r,s[d]),i.gameboard.getPrivateGrid(),d++,f("populate"),o(`${c[d]}`),d>=5&&n.startGame()}e.forEach((e=>{e.addEventListener("click",t)}))},attackListenerCell:function(){t.forEach((e=>{e.addEventListener("mouseover",u),e.addEventListener("click",h)}))}}}(),o=function(e,t){if(document.querySelector(".message > p").innerHTML=e,"add"==t){let e=document.createElement("button");e.textContent="Rotate Ship",document.querySelector(".message").append(e)}else if("del"==t){let e=document.querySelector(".message");e.removeChild(e.lastChild)}};n.initiateGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2hDLElBQUlLLEVBQWdCOUIsU0FBU0MsY0FBYyxZQUMzQzZCLEVBQWNDLFlBQVlELEVBQWNFLFVBQzFDLENBQ0YsRUMvVUFwRSxFQUFLaUIsYyIsInNvdXJjZXMiOlsid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9jb250cm9sLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9tYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IEhvdE1vZHVsZVJlcGxhY2VtZW50UGx1Z2luIH0gZnJvbSBcIndlYnBhY2tcIjtcbi8vIGFkZCBjb21tZW50IHRvIHRoZSBiZWxsb3cgaW1wb3J0IGZvciB0aGUgSmVzdCB0ZXN0IHRvIHdvcmtcbmltcG9ydCB7IGdhbWUsIGh1bWFuIH0gZnJvbSBcIi4vY29udHJvbFwiO1xuXG4vLyBTaGFyZWQgdmFyaWFibGVzXG5sZXQgc2hpcENsYXNzZXMgPSB7XG4gIDI6IFwiUGF0cm9sIEJvYXRcIixcbiAgMzogXCJTdWJtYXJpbmVcIixcbiAgMzogXCJEZXN0cm95ZXJcIixcbiAgNDogXCJCYXR0bGVzaGlwXCIsXG4gIDU6IFwiQ2FycmllclwiLFxufTtcbi8vIFVzZWQgdG8gY3JlYXRlIFMxIFMyIFMzIG5hbWVzIGluIHRoZSBnYW1lYm9hcmQgZ3JpZFxuXG4vLyBTaGlwIGZhY3RvcnkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBzaGlwRmFjdG9yeShzaGlwTGVuZ3RoLCBzaGlwSWQpIHtcbiAgLy8gU2hpcHMgY2FuIG9ubHkgcmFuZ2UgZnJvbSBzaXplIDIgdG8gNSBhcyBzcGVjaWZpZWQgaW4gdGhlIGNsYXNzZXNcbiAgaWYgKCFzaGlwTGVuZ3RoIHx8IHNoaXBMZW5ndGggPiA1IHx8IHNoaXBMZW5ndGggPD0gMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkxlbmd0aCBtdXN0IGJlIGJldHdlZW4gMiBhbmQgNVwiKTtcbiAgfVxuICAvLyBJbml0aWFsaXplIHNoaXBcbiAgbGV0IHR5cGUgPSBzaGlwQ2xhc3Nlc1tzaGlwTGVuZ3RoXTtcbiAgbGV0IGZ1c2VsYWdlID0gQXJyYXkoc2hpcExlbmd0aCkuZmlsbCh0cnVlKTtcbiAgbGV0IGFsbENvb3IgPSBBcnJheSgpO1xuICBsZXQgZ2V0RnVzZWxhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIFsuLi5mdXNlbGFnZV07XG4gIH07XG4gIGxldCBnZXRDb29yID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBbLi4uYWxsQ29vcl07XG4gIH07XG4gIC8vIFNhdmUgY29vcmRpbmF0ZXMgb2Ygc2hpcFxuICAvLyBjb29yIGlzIGFuIG9iamVjdCB7eCwgeX1cbiAgbGV0IHNldENvb3IgPSBmdW5jdGlvbiAoY29vcikge1xuICAgIGFsbENvb3IucHVzaCh7IHg6IGNvb3IueCwgeTogY29vci55IH0pO1xuICB9O1xuICAvLyBVc2UgY29vcmRpbmF0ZXMgdG8gbG9jYXRlIGluZGV4IGFuZCB0aGVuIGNoYW5nZSBmdXNlbGFnZSBzdGF0ZVxuICBsZXQgaGl0ID0gZnVuY3Rpb24gKGNvb3IpIHtcbiAgICBsZXQgaGl0U3VjY2VzcyA9IGZhbHNlO1xuICAgIGFsbENvb3IuZm9yRWFjaCgoZWxlbSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChKU09OLnN0cmluZ2lmeShlbGVtKSA9PSBKU09OLnN0cmluZ2lmeShjb29yKSkge1xuICAgICAgICBmdXNlbGFnZVtpbmRleF0gPSBmYWxzZTtcbiAgICAgICAgaGl0U3VjY2VzcyA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGhpdFN1Y2Nlc3M7XG4gIH07XG4gIC8vIEV2YWx1YXRlIGlmIHRoZSBzaGlwIGlzIGFsbCBmaWxsZWQgd2l0aCBoaXRzXG4gIGxldCBpc1N1bmsgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGZ1c2VsYWdlLmV2ZXJ5KChlbGVtKSA9PiAhZWxlbSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIHJldHVybiB7XG4gICAgc2hpcElkLFxuICAgIHR5cGUsXG4gICAgc2hpcExlbmd0aCxcbiAgICBnZXRGdXNlbGFnZSxcbiAgICBzZXRDb29yLFxuICAgIGdldENvb3IsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgfTtcbn1cblxuLy8gR2FtZWJvYXJkIGZhY3RvcnkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gZ2FtZWJvYXJkRmFjdG9yeSgpIHtcbiAgbGV0IHNoaXBJZENvdW50ZXIgPSAxO1xuICBsZXQgc2hpcExpc3QgPSBbXTtcbiAgLy8gJzAnIHdhcyBjaG9zZW4gdG8gcmVwcmVzZW50IGFuIGVtcHR5IHNsb3RcbiAgLy8gZ3JpZFt4XVt5XVxuICAvLyBncmlkIGxlZ2VuZCAwOiBFbXB0eVxuICAvLyAgICAgICAgICAgICBTWDogU2hpcCBJRFxuICAvLyAgICAgICAgICAgICBIOiBTaGlwIGlzIGhpdFxuICAvLyAgICAgICAgICAgICBNOiBNaXNzZWQgc2hvdFxuICBsZXQgZ3JpZCA9IEFycmF5KDEwKVxuICAgIC5maWxsKFwiMFwiKVxuICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwoXCIwXCIpKTtcbiAgbGV0IGdldFByaXZhdGVHcmlkID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGdyaWQpKTtcbiAgfTtcbiAgLy8gQ3JlYXRlIHRoZSBncmlkIGZyb20gYW4gZW5lbXkgcG9pbnQgb2Ygdmlld1xuICBsZXQgZ2V0UHVibGljR3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgcHVibGljR3JpZCA9IGdyaWQubWFwKChlbGVtZW50KSA9PiB7XG4gICAgICByZXR1cm4gZWxlbWVudC5tYXAoKGVsZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGVsZW1bMF0gPT0gXCJIXCIgfHwgZWxlbVswXSA9PSBcIk1cIiA/IGVsZW1bMF0gOiBcIjBcIjtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHB1YmxpY0dyaWQpKTtcbiAgfTtcbiAgbGV0IHBsYWNlU2hpcCA9IGZ1bmN0aW9uIChjb29yLCBzaGlwTGVuZ3RoKSB7XG4gICAgaWYgKGNvb3IuZGlyID09IFwieFwiICYmIGNvb3IueCArIHNoaXBMZW5ndGggPiAxMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT3V0c2lkZSBvZiBncmlkXCIpO1xuICAgIH0gZWxzZSBpZiAoY29vci5kaXIgPT0gXCJ5XCIgJiYgY29vci55ICsgc2hpcExlbmd0aCA+IDEwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPdXRzaWRlIG9mIGdyaWRcIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMlxuICAgIC8vIENoZWNrIGlmIG5vIG92ZXJsYXAgd2l0aCBvdGhlciBzaGlwXG4gICAgaWYgKGNvb3IuZGlyID09IFwieFwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZ3JpZFtjb29yLnggKyBpXVtjb29yLnldWzBdID09IFwiU1wiKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW50ZXJmZXJlbmNlXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjb29yLmRpciA9PSBcInlcIikge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGdyaWRbY29vci54XVtjb29yLnkgKyBpXVswXSA9PSBcIlNcIikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludGVyZmVyZW5jZVwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBsZXQgc2hpcElkID0gYFMke3NoaXBJZENvdW50ZXJ9YDtcbiAgICBzaGlwSWRDb3VudGVyKys7XG4gICAgbGV0IHNoaXAgPSBzaGlwRmFjdG9yeShzaGlwTGVuZ3RoLCBzaGlwSWQpO1xuICAgIHNoaXBMaXN0LnB1c2goc2hpcCk7XG4gICAgaWYgKGNvb3IuZGlyID09IFwieFwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBncmlkW2Nvb3IueCArIGldW2Nvb3IueV0gPSBzaGlwSWQ7XG4gICAgICAgIHNoaXAuc2V0Q29vcih7IHg6IGNvb3IueCArIGksIHk6IGNvb3IueSB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNvb3IuZGlyID09IFwieVwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBncmlkW2Nvb3IueF1bY29vci55ICsgaV0gPSBzaGlwSWQ7XG4gICAgICAgIHNoaXAuc2V0Q29vcih7IHg6IGNvb3IueCwgeTogY29vci55ICsgaSB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNoaXA7XG4gICAgLy8gYWRkIHNoaXAgdG8gZ2FtZWJvYXJkIGFycmF5XG4gIH07XG4gIGxldCBhdHRhY2sgPSBmdW5jdGlvbiAoY29vcikge1xuICAgIGlmIChjb29yLnggPCAwIHx8IGNvb3IueCA+IDkgfHwgY29vci55IDwgMCB8fCBjb29yLnkgPiA5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPdXRzaWRlIG9mIGdyaWRcIik7XG4gICAgfVxuICAgIGlmIChncmlkW2Nvb3IueF1bY29vci55XVswXSA9PSBcIlNcIikge1xuICAgICAgZ3JpZFtjb29yLnhdW2Nvb3IueV0gPSBncmlkW2Nvb3IueF1bY29vci55XS5yZXBsYWNlKFwiU1wiLCBcIkhcIik7XG4gICAgICBzaGlwTGlzdC5maW5kKChpdGVtLCBpbmRleCwgYXJyYXkpID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW0uaGl0KGNvb3IpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gXCJIaXRcIjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgZ3JpZFtjb29yLnhdW2Nvb3IueV1bMF0gPT0gXCJIXCIgfHxcbiAgICAgIGdyaWRbY29vci54XVtjb29yLnldWzBdID09IFwiTVwiXG4gICAgKSB7XG4gICAgICByZXR1cm4gXCJBbHJlYWR5IGhpdFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBncmlkW2Nvb3IueF1bY29vci55XSA9IFwiTVwiO1xuICAgICAgcmV0dXJuIFwiTWlzc1wiO1xuICAgIH1cbiAgfTtcbiAgbGV0IGlzQWxsSGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBzaGlwTGlzdC5ldmVyeSgoZWxlbSkgPT4gZWxlbS5pc1N1bmsoKSk7XG4gIH07XG4gIHJldHVybiB7XG4gICAgc2hpcExpc3QsXG4gICAgZ2V0UHJpdmF0ZUdyaWQsXG4gICAgZ2V0UHVibGljR3JpZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgYXR0YWNrLFxuICAgIGlzQWxsSGl0LFxuICB9O1xufVxuXG4vLyBQbGF5ZXIgZmFjdG9yeSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5sZXQgcGxheWVyRmFjdG9yeSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gIGlmICh0eXBlID09IFwiSHVtYW5cIikge1xuICAgIGxldCBnYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiSHVtYW5cIixcbiAgICAgIHNjb3JlOiAwLFxuICAgICAgZ2FtZWJvYXJkLFxuICAgICAgcGxhY2VTaGlwOiBmdW5jdGlvbiAoY29vciwgc2hpcExlbmd0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nYW1lYm9hcmQucGxhY2VTaGlwKGNvb3IsIHNoaXBMZW5ndGgpO1xuICAgICAgfSxcbiAgICAgIHJlY2VpdmVIaXQ6IGZ1bmN0aW9uIChjb29yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdhbWVib2FyZC5hdHRhY2soY29vcik7XG4gICAgICB9LFxuICAgIH07XG4gIH0gZWxzZSBpZiAodHlwZSA9PSBcIkNvbXB1dGVyXCIpIHtcbiAgICBsZXQgZ2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkNvbXB1dGVyXCIsXG4gICAgICBzY29yZTogMCxcbiAgICAgIGdhbWVib2FyZCxcbiAgICAgIHBsYWNlU2hpcDogZnVuY3Rpb24gKGNvb3IsIEwpIHtcbiAgICAgICAgaWYgKGNvb3IpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lYm9hcmQucGxhY2VTaGlwKGNvb3IsIEwpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJhbmRvbWx5IHBsYWNlcyBzaGlwcyBpbnRvIHRoZSBnYW1lYm9hcmQgZ3JpcFxuICAgICAgICBsZXQgc2hpcExlbmd0aCA9IFs1LCA0LCAzLCAzLCAyXTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgICAgbGV0IGRpciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09IDAgPyBcInhcIiA6IFwieVwiO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHsgeCwgeSwgZGlyIH0sIHNoaXBMZW5ndGhbaV0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpLS07XG4gICAgICAgICAgfVxuICAgICAgICAgIGkrKztcbiAgICAgICAgfSB3aGlsZSAoaSA8IDUpO1xuICAgICAgfSxcbiAgICAgIHJlY2VpdmVIaXQ6IGZ1bmN0aW9uIChjb29yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdhbWVib2FyZC5hdHRhY2soY29vcik7XG4gICAgICB9LFxuICAgICAgYXR0YWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBncmlkSHVtYW4gPSBKU09OLnBhcnNlKFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGh1bWFuLmdhbWVib2FyZC5nZXRQdWJsaWNHcmlkKCkpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBodW1hbi5nYW1lYm9hcmQuZ2V0UHVibGljR3JpZCgpLmV2ZXJ5KChlbGVtLCB4KSA9PlxuICAgICAgICAgICAgZWxlbS5ldmVyeSgoZWxlbSwgeSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoZWxlbSA9PSBcIkhcIikge1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIHRoZSBhZGphY2VudCBncmlkIGJsb2NrXG4gICAgICAgICAgICAgICAgbGV0IGNvb3JUZW1wID0gW1xuICAgICAgICAgICAgICAgICAgeyB4OiB4ICsgMSwgeTogeSB9LFxuICAgICAgICAgICAgICAgICAgeyB4OiB4IC0gMSwgeTogeSB9LFxuICAgICAgICAgICAgICAgICAgeyB4OiB4LCB5OiB5ICsgMSB9LFxuICAgICAgICAgICAgICAgICAgeyB4OiB4LCB5OiB5IC0gMSB9LFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvb3JUZW1wLmV2ZXJ5KChjb29yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBjb29yIGFyZSBub3Qgb3V0c2lkZSBvZiBncmlkXG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGNvb3IueCA+PSAwICYmXG4gICAgICAgICAgICAgICAgICAgIGNvb3IueCA8IDEwICYmXG4gICAgICAgICAgICAgICAgICAgIGNvb3IueSA+PSAwICYmXG4gICAgICAgICAgICAgICAgICAgIGNvb3IueSA8IDEwXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRIdW1hbltjb29yLnhdW2Nvb3IueV0gPT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICBodW1hbi5yZWNlaXZlSGl0KGNvb3IpO1xuICAgICAgICAgICAgICAgICAgICAgIGdhbWUucm91bmQoKTtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHN1cnJvdW5kaW5nIGNlbGwgZG9lcyBoYXZlIDBcbiAgICAgICAgICAgICAgICAvLyBIaXQgdGhlIHN1cnJvdW5kaW5nIGNlbGwgdGhhdCBoYXMgYSB6ZXJvIGFuZCByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAvLyBJZiBub3QgdGhlbiByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIHJldHVybiB0cnVlIGlzIHRoZXJlIGFyZSBubyBoaXRzIGluIHRoZSBncmlkIHNvIHRoYXRcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gaWYgdGhlIGV2ZXJ5IG1ldGhvZCBmaW5kcyBubyBwb3NzaWJsZSBoaXQsIHRoZSByYW5kb20gaGl0XG4gICAgICAgICAgLy8gZ2VuZXJhdG9yIHdpbGwgZXhlY3V0ZSBiZWxsb3cuXG4gICAgICAgICAgbGV0IGxvb3AgPSBmYWxzZTtcbiAgICAgICAgICBkbyB7XG4gICAgICAgICAgICBsZXQgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgICAgIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICAgICAgbGV0IGNvb3IgPSB7IHgsIHkgfTtcbiAgICAgICAgICAgIGxldCByZWdDaGVjayA9IC9BbHJlYWR5IGhpdC87XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsZXQgaGl0ID0gaHVtYW4ucmVjZWl2ZUhpdChjb29yKTtcbiAgICAgICAgICAgICAgaWYgKHJlZ0NoZWNrLnRlc3QoaGl0KSkge1xuICAgICAgICAgICAgICAgIGxvb3AgPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvb3AgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgbG9vcCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSB3aGlsZSAobG9vcCk7XG4gICAgICAgICAgZ2FtZS5yb3VuZCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgdHlwZVwiKTtcbiAgfVxufTtcblxuZXhwb3J0IHsgcGxheWVyRmFjdG9yeSwgZ2FtZWJvYXJkRmFjdG9yeSwgc2hpcEZhY3RvcnkgfTtcbiIsImltcG9ydCB7IHBsYXllckZhY3RvcnkgfSBmcm9tIFwiLi9mYWN0b3J5XCI7XG5cbmxldCBodW1hbiA9IHBsYXllckZhY3RvcnkoXCJIdW1hblwiKTtcbmxldCBjb21wdXRlciA9IHBsYXllckZhY3RvcnkoXCJDb21wdXRlclwiKTtcblxuLy8gVGhpcyBnYW1lIG1vZHVsZSB1c2luZyB0byBjb250cm9sIHRoZSBtYWluIGV2ZW50IG9mIHRoZSBnYW1lXG5sZXQgZ2FtZSA9IChmdW5jdGlvbiAoKSB7XG4gIGxldCBjdXJyZW50UGxheWVyID0gXCJIdW1hblwiO1xuICBsZXQgaW5pdGlhdGVHYW1lID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbXB1dGVyID0gcGxheWVyRmFjdG9yeShcIkNvbXB1dGVyXCIpO1xuICAgIGh1bWFuID0gcGxheWVyRmFjdG9yeShcIkh1bWFuXCIpO1xuICAgIHBsYWNlU2hpcCgpO1xuICB9O1xuICAvLyBTdGFydHMgdGhlIHBsYWNlc2hpcCBNT0RFXG4gIGxldCBwbGFjZVNoaXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZGlzcGxheUdyaWQuY29uZmlndXJlKFwicGxhY2VTaGlwXCIpO1xuICAgIGRpc3BsYXlHcmlkLmNhY2hlRE9NKCk7XG4gICAgZGlzcGxheUdyaWQucm90YXRlQnV0dG9uKFwib25cIik7XG4gICAgZGlzcGxheUdyaWQuc3RhcnRIaWdobGlnaHRDZWxsKFwicGxhY2VTaGlwXCIpO1xuICAgIGRpc3BsYXlHcmlkLnJlZ2lzdGVyUGxhY2VTaGlwQ2VsbCgpO1xuICB9O1xuICAvLyBTdG9wcyB0aGUgcGxhY2VzaGlwIE1PREUgYW5kIHN0YXJ0IEdhbWUgTU9ERVxuICBsZXQgc3RhcnRHYW1lID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIFNldHVwIHRoZSBsYXlvdXRzXG4gICAgZGlzcGxheUdyaWQuY29uZmlndXJlKFwiZ2FtZU9uXCIpO1xuICAgIGRpc3BsYXlHcmlkLnJlZnJlc2goXCJyZXNldFwiKTtcbiAgICBkaXNwbGF5R3JpZC5yZWZyZXNoKFwicG9wdWxhdGVcIik7XG4gICAgbWVzc2FnZShcIlBsYWNlIHlvdXIgaGl0cyBvbiBlbmVteSB3YXRlcnNcIik7XG4gICAgLy8gbWFrZSB0aGUgY29tcHV0ZXIgcGxhY2UgaXRzIHNoaXAgcmFuZG9tbHlcbiAgICBjb21wdXRlci5wbGFjZVNoaXAoKTtcbiAgICBkaXNwbGF5R3JpZC5jYWNoZURPTSgpO1xuICAgIGRpc3BsYXlHcmlkLmF0dGFja0xpc3RlbmVyQ2VsbCgpO1xuICAgIGRpc3BsYXlHcmlkLnN0YXJ0SGlnaGxpZ2h0Q2VsbChcImdhbWVPblwiKTtcbiAgICAvLyBTdGFydCB0aGUgcm91bmRzXG4gICAgcm91bmQoKTtcbiAgfTtcbiAgbGV0IHJvdW5kID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChjaGVja0lmV29uKCkpIHtcbiAgICAgIGRpc3BsYXlHcmlkLnJlZnJlc2goXCJwb3B1bGF0ZVwiKTtcbiAgICAgIGVuZEdhbWUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gXCJIdW1hblwiKSB7XG4gICAgICBjdXJyZW50UGxheWVyID0gY3VycmVudFBsYXllciA9PSBcIkh1bWFuXCIgPyBcIkNvbXB1dGVyXCIgOiBcIkh1bWFuXCI7XG4gICAgfSBlbHNlIGlmIChjdXJyZW50UGxheWVyID09IFwiQ29tcHV0ZXJcIikge1xuICAgICAgY3VycmVudFBsYXllciA9IGN1cnJlbnRQbGF5ZXIgPT0gXCJIdW1hblwiID8gXCJDb21wdXRlclwiIDogXCJIdW1hblwiO1xuICAgICAgbWVzc2FnZShcIlwiKTtcbiAgICAgIGNvbXB1dGVyLmF0dGFjaygpO1xuICAgICAgZGlzcGxheUdyaWQucmVmcmVzaChcInBvcHVsYXRlXCIpO1xuICAgIH1cbiAgfTtcbiAgbGV0IGNoZWNrSWZXb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGh1bWFuLmdhbWVib2FyZC5pc0FsbEhpdCgpIHx8IGNvbXB1dGVyLmdhbWVib2FyZC5pc0FsbEhpdCgpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgbGV0IGdldEdyaWQgPSBmdW5jdGlvbiAocGxheWVyKSB7XG4gICAgaWYgKHBsYXllciA9PSBcImh1bWFuXCIpIHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGh1bWFuLmdhbWVib2FyZC5nZXRQcml2YXRlR3JpZCgpKSk7XG4gICAgfSBlbHNlIGlmIChwbGF5ZXIgPT0gXCJjb21wdXRlclwiKSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb21wdXRlci5nYW1lYm9hcmQuZ2V0UHVibGljR3JpZCgpKSk7XG4gICAgfVxuICB9O1xuICBsZXQgZW5kR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBjdXJyZW50UGxheWVyID0gY3VycmVudFBsYXllciA9PSBcIkh1bWFuXCIgPyBcIkNvbXB1dGVyXCIgOiBcIkh1bWFuXCI7XG4gICAgZGlzcGxheUdyaWQucmVmcmVzaChcInJlc2V0XCIpO1xuICAgIG1lc3NhZ2UoYCR7Y3VycmVudFBsYXllcn0gV29uYCk7XG4gIH07XG4gIHJldHVybiB7XG4gICAgaW5pdGlhdGVHYW1lLFxuICAgIHN0YXJ0R2FtZSxcbiAgICBlbmRHYW1lLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRHcmlkLFxuICAgIHJvdW5kLFxuICB9O1xufSkoKTtcblxubGV0IGRpc3BsYXlHcmlkID0gKGZ1bmN0aW9uICgpIHtcbiAgbGV0IG1vdXNlQ29vciA9IHtcbiAgICB5OiAwLFxuICAgIHg6IDAsXG4gICAgZGlyOiBcInhcIixcbiAgfTtcbiAgbGV0IG1lc3NhZ2VzID0gW1xuICAgIFwiUGxhY2UgeW91ciBjYXJyaWVyIGNhcHRhaW5cIixcbiAgICBcIlBsYWNlIHlvdXIgYmF0dGxlc2hpcCBjYXB0YWluXCIsXG4gICAgXCJQbGFjZSB5b3VyIGRlc3Ryb3llciBjYXB0YWluXCIsXG4gICAgXCJQbGFjZSB5b3VyIHN1Ym1hcmluZSBjYXB0YWluXCIsXG4gICAgXCJQbGFjZSB5b3VyIHBhdHJvbCBib2F0IGNhcHRhaW5cIixcbiAgXTtcbiAgbGV0IHNoaXBTaXplcyA9IFs1LCA0LCAzLCAzLCAyXTtcbiAgbGV0IHNoaXBTaXplSW5kZXggPSAwO1xuICBsZXQgZ3JpZExlZnRET007XG4gIGxldCBncmlkUmlnaHRET007XG4gIC8vIE1PVVNFT1ZFUiB1cGRhdGUgY3Vyc29yIGNvb3JkaW5hdGVzIHdoZW4gaG92ZXJpbmcgYWJvdmUgZ3JpZCBmb3IgbW91c2VvdmVyIGV2ZW50XG4gIC8vIGxpc3RlbmVycyB1c2VkIGZvciBzdGFydEhpZ2hsaWdodENlbGwgYW5kIGF0dGFja0xpc3RlbmVyQ2VsbFxuICBsZXQgdXBkYXRlQ3Vyc29yID0gZnVuY3Rpb24gKGUpIHtcbiAgICBtb3VzZUNvb3IueCA9IHBhcnNlSW50KGUudGFyZ2V0LmlkWzEyXSk7XG4gICAgbW91c2VDb29yLnkgPSBwYXJzZUludChlLnRhcmdldC5pZFs2XSk7XG4gIH07XG4gIGxldCBjYWNoZURPTSA9IGZ1bmN0aW9uICgpIHtcbiAgICBncmlkTGVmdERPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBcIi5ncmlkLWxlZnQgPiAuZ3JpZC1sYXlvdXQgPiAuY2VsbC1wMVwiXG4gICAgKTtcbiAgICBncmlkUmlnaHRET00gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgXCIuZ3JpZC1yaWdodCA+IC5ncmlkLWxheW91dCA+IC5jZWxsLXAxXCJcbiAgICApO1xuICB9O1xuICBsZXQgY29uZmlndXJlID0gZnVuY3Rpb24gKG1vZGUpIHtcbiAgICBsZXQgZ3JpZExlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdyaWQtbGVmdFwiKTtcbiAgICBsZXQgZ3JpZFJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkLXJpZ2h0XCIpO1xuICAgIGlmIChtb2RlID09IFwicGxhY2VTaGlwXCIpIHtcbiAgICAgIG1lc3NhZ2UoXCJcIiwgXCJhZGRcIik7XG4gICAgICBtZXNzYWdlKGAke21lc3NhZ2VzW3NoaXBTaXplSW5kZXhdfWApO1xuICAgICAgZ3JpZExlZnQuY2xhc3NMaXN0LmFkZChcImdyaWQtbWlkZGxlXCIpO1xuICAgICAgZ3JpZFJpZ2h0LmNsYXNzTGlzdC5hZGQoXCJncmlkLWhpZGVcIik7XG4gICAgfSBlbHNlIGlmIChtb2RlID09IFwiZ2FtZU9uXCIpIHtcbiAgICAgIG1lc3NhZ2UoXCJcIiwgXCJkZWxcIik7XG4gICAgICBncmlkTGVmdC5jbGFzc0xpc3QucmVtb3ZlKFwiZ3JpZC1taWRkbGVcIik7XG4gICAgICBncmlkUmlnaHQuY2xhc3NMaXN0LnJlbW92ZShcImdyaWQtaGlkZVwiKTtcbiAgICB9XG4gIH07XG4gIGxldCBzdGFydEhpZ2hsaWdodENlbGwgPSBmdW5jdGlvbiAobW9kZSkge1xuICAgIC8vIGJlIGFibGUgdG8gaGlnaGxpZ2h0IGludGVyZmVyZW5jZSB3aXRoIGFscmVhZHkgcGxhY2VkIHNoaXBzXG4gICAgaWYgKG1vZGUgPT0gXCJwbGFjZVNoaXBcIikge1xuICAgICAgZ3JpZExlZnRET00uZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgdXBkYXRlQ3Vyc29yKTtcbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGhpZ2hsaWdodEN1cnNvcik7XG4gICAgICB9KTtcbiAgICAgIC8vIE1PVVNFT1ZFUiBoaWdobGlnaHQgY3Vyc29yIGFuZCBzaW11bGF0ZSBzaGlwIHByZXNlbmNlXG4gICAgICBmdW5jdGlvbiBoaWdobGlnaHRDdXJzb3IoZSkge1xuICAgICAgICBtZXNzYWdlKGAke21lc3NhZ2VzW3NoaXBTaXplSW5kZXhdfWApO1xuICAgICAgICByZWZyZXNoKFwiaGlnaGxpZ2h0XCIpO1xuICAgICAgICBsZXQgY29vckxpbmVhciA9IHBhcnNlSW50KG1vdXNlQ29vci54KSArIHBhcnNlSW50KG1vdXNlQ29vci55KSAqIDEwO1xuICAgICAgICAvLyBDaGVjayBpZiBzaGlwIGlzIG91dCBvZiBib3VuZHNcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChtb3VzZUNvb3IuZGlyID09IFwieFwiICYmXG4gICAgICAgICAgICBzaGlwU2l6ZXNbc2hpcFNpemVJbmRleF0gKyBwYXJzZUludChtb3VzZUNvb3IueCkgPiAxMCkgfHxcbiAgICAgICAgICAobW91c2VDb29yLmRpciA9PSBcInlcIiAmJlxuICAgICAgICAgICAgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdICsgcGFyc2VJbnQobW91c2VDb29yLnkpID4gMTApXG4gICAgICAgICkge1xuICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXJdLmNsYXNzTGlzdC5hZGQoXCJjZWxsLWhvdmVyLW91dEJvdW5kXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBoaWdobGlnaHQgcmVkIHdoZW4gYSBzaGlwIGFscmVhZHkgZXhpc3RcbiAgICAgICAgbGV0IGh1bWFuR3JpZCA9IGh1bWFuLmdhbWVib2FyZC5nZXRQcml2YXRlR3JpZCgpO1xuICAgICAgICBpZiAobW91c2VDb29yLmRpciA9PSBcInhcIikge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChodW1hbkdyaWRbbW91c2VDb29yLnggKyBpXVttb3VzZUNvb3IueV1bMF0gPT0gXCJTXCIpIHtcbiAgICAgICAgICAgICAgZ3JpZExlZnRET01bY29vckxpbmVhciArIGldLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICAgICAgICAgXCJjZWxsLXNoaXAtaGlnaGxpZ2h0LWludGVyZmVyZW5jZVwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG1vdXNlQ29vci5kaXIgPT0gXCJ5XCIpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBTaXplc1tzaGlwU2l6ZUluZGV4XTsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaHVtYW5HcmlkW21vdXNlQ29vci54XVttb3VzZUNvb3IueSArIGldWzBdID09IFwiU1wiKSB7XG4gICAgICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXIgKyBpICogMTBdLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICAgICAgICAgXCJjZWxsLXNoaXAtaGlnaGxpZ2h0LWludGVyZmVyZW5jZVwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIENyZWF0ZSBzaGlwIGhpZ2hsaWdodFxuICAgICAgICBpZiAobW91c2VDb29yLmRpciA9PSBcInhcIikge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdOyBpKyspIHtcbiAgICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXIgKyBpXS5jbGFzc0xpc3QuYWRkKFwiY2VsbC1ob3ZlclwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobW91c2VDb29yLmRpciA9PSBcInlcIikge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdOyBpKyspIHtcbiAgICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXIgKyBpICogMTBdLmNsYXNzTGlzdC5hZGQoXCJjZWxsLWhvdmVyXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobW9kZSA9PSBcImdhbWVPblwiKSB7XG4gICAgICAvLyBUaGlzIG1vZGUgaXMgdG8gY3JlYXRlIGEgaG92ZXIgZWZmZWN0IHdoZW4gYWltaW5nIGF0IGVuZW15IHdhdGVyc1xuICAgICAgZ3JpZFJpZ2h0RE9NLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGhpZ2hsaWdodEN1cnNvcik7XG4gICAgICB9KTtcbiAgICAgIGZ1bmN0aW9uIGhpZ2hsaWdodEN1cnNvcihlKSB7XG4gICAgICAgIHJlZnJlc2goXCJoaWdobGlnaHRcIik7XG4gICAgICAgIGxldCBjb29yTGluZWFyID0gcGFyc2VJbnQobW91c2VDb29yLngpICsgcGFyc2VJbnQobW91c2VDb29yLnkpICogMTA7XG4gICAgICAgIGdyaWRSaWdodERPTVtjb29yTGluZWFyXS5jbGFzc0xpc3QuYWRkKFwiY2VsbC1ob3Zlci1hdHRhY2tcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBsZXQgcmVnaXN0ZXJQbGFjZVNoaXBDZWxsID0gZnVuY3Rpb24gKCkge1xuICAgIGdyaWRMZWZ0RE9NLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJlZ2lzdGVyU2hpcExvY2F0aW9uKTtcbiAgICB9KTtcbiAgICBmdW5jdGlvbiByZWdpc3RlclNoaXBMb2NhdGlvbihlKSB7XG4gICAgICBsZXQgaHVtYW5HcmlkID0gaHVtYW4uZ2FtZWJvYXJkLmdldFByaXZhdGVHcmlkKCk7XG4gICAgICAvLyBDaGVjayBpZiBhbnkgaW50ZXJmZXJlbmNlIHdpdGggYW5vdGhlciBhbHJlYWR5IHBsYWNlZCBzaGlwXG4gICAgICBpZiAobW91c2VDb29yLmRpciA9PSBcInhcIikge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBTaXplc1tzaGlwU2l6ZUluZGV4XTsgaSsrKSB7XG4gICAgICAgICAgaWYgKGh1bWFuR3JpZFttb3VzZUNvb3IueCArIGldW21vdXNlQ29vci55XVswXSA9PSBcIlNcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChtb3VzZUNvb3IuZGlyID09IFwieVwiKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdOyBpKyspIHtcbiAgICAgICAgICBpZiAoaHVtYW5HcmlkW21vdXNlQ29vci54XVttb3VzZUNvb3IueSArIGldWzBdID09IFwiU1wiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBtZXNzYWdlKGAke21lc3NhZ2VzW3NoaXBTaXplSW5kZXhdfWApO1xuICAgICAgaHVtYW4ucGxhY2VTaGlwKG1vdXNlQ29vciwgc2hpcFNpemVzW3NoaXBTaXplSW5kZXhdKTtcbiAgICAgIGh1bWFuLmdhbWVib2FyZC5nZXRQcml2YXRlR3JpZCgpO1xuICAgICAgc2hpcFNpemVJbmRleCsrO1xuICAgICAgcmVmcmVzaChcInBvcHVsYXRlXCIpO1xuICAgICAgbWVzc2FnZShgJHttZXNzYWdlc1tzaGlwU2l6ZUluZGV4XX1gKTtcbiAgICAgIGlmIChzaGlwU2l6ZUluZGV4ID49IDUpIHtcbiAgICAgICAgZ2FtZS5zdGFydEdhbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGxldCBhdHRhY2tMaXN0ZW5lckNlbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ3JpZFJpZ2h0RE9NLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCB1cGRhdGVDdXJzb3IpO1xuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXR0YWNrQ2VsbCk7XG4gICAgfSk7XG4gIH07XG4gIC8vIFRoaXMgZnVuY3Rpb24gbmVlZCB0byBiZSBpbiB0aGUgc2NvcGUgb2YgZGlzcGxheUdyaWQgYmVjYXVzZSBpdFxuICAvLyBzaG91bGQgYmUgYWNjZXNlZCBieSB0aGUgcmVmcmVzaCBmdW5jdGlvblxuICAvLyByZWNlaXZlIGF0dGFjayBuZWVkcyBvYmplY3Qgd2l0aCBvbmx5IHggYW5kIHkgcHJvcGVydGllc1xuICBmdW5jdGlvbiBhdHRhY2tDZWxsKCkge1xuICAgIGNvbXB1dGVyLnJlY2VpdmVIaXQoeyB4OiBtb3VzZUNvb3IueCwgeTogbW91c2VDb29yLnkgfSk7XG4gICAgcmVmcmVzaChcInBvcHVsYXRlXCIpO1xuICAgIGRpc3BsYXlHcmlkLnJlZnJlc2goXCJyZW1vdmVMaXN0ZW5lclwiKTtcbiAgICBnYW1lLnJvdW5kKCk7XG4gIH1cbiAgbGV0IHJlZnJlc2ggPSBmdW5jdGlvbiAobW9kZSkge1xuICAgIC8vIFJlc2V0IHRoZSBncmlkIGZyb20gYW55IGV2ZW50IGxpc3RlbmVyXG4gICAgaWYgKG1vZGUgPT0gXCJyZXNldFwiKSB7XG4gICAgICAvLyBMZWZ0IHNpZGVcbiAgICAgIGxldCBvbGRfZWxlbWVudExlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdyaWQtbGVmdCA+IC5ncmlkLWxheW91dFwiKTtcbiAgICAgIGxldCBuZXdfZWxlbWVudExlZnQgPSBvbGRfZWxlbWVudExlZnQuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgb2xkX2VsZW1lbnRMZWZ0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld19lbGVtZW50TGVmdCwgb2xkX2VsZW1lbnRMZWZ0KTtcbiAgICAgIC8vIFJpZ2h0IHNpZGVcbiAgICAgIGxldCBvbGRfZWxlbWVudFJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgXCIuZ3JpZC1yaWdodCA+IC5ncmlkLWxheW91dFwiXG4gICAgICApO1xuICAgICAgbGV0IG5ld19lbGVtZW50UmlnaHQgPSBvbGRfZWxlbWVudFJpZ2h0LmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIG9sZF9lbGVtZW50UmlnaHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoXG4gICAgICAgIG5ld19lbGVtZW50UmlnaHQsXG4gICAgICAgIG9sZF9lbGVtZW50UmlnaHRcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChtb2RlID09IFwicG9wdWxhdGVcIikge1xuICAgICAgbGV0IGh1bWFuR3JpZFByaXZhdGUgPSBodW1hbi5nYW1lYm9hcmQuZ2V0UHJpdmF0ZUdyaWQoKTtcbiAgICAgIGh1bWFuR3JpZFByaXZhdGUuZm9yRWFjaCgoZWxlbVJvdywgaW5kZXhYKSA9PiB7XG4gICAgICAgIGVsZW1Sb3cuZm9yRWFjaCgoZWFjaEdyaWQsIGluZGV4WSkgPT4ge1xuICAgICAgICAgIGlmIChlYWNoR3JpZFswXSA9PSBcIlNcIikge1xuICAgICAgICAgICAgbGV0IGNvb3JMaW5lYXIgPSBwYXJzZUludChpbmRleFgpICsgcGFyc2VJbnQoaW5kZXhZKSAqIDEwO1xuICAgICAgICAgICAgZ3JpZExlZnRET01bY29vckxpbmVhcl0uY2xhc3NMaXN0LmFkZChcImNlbGwtc2hpcC1wcmVzZW50XCIpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZWFjaEdyaWRbMF0gPT0gXCJIXCIpIHtcbiAgICAgICAgICAgIGxldCBjb29yTGluZWFyID0gcGFyc2VJbnQoaW5kZXhYKSArIHBhcnNlSW50KGluZGV4WSkgKiAxMDtcbiAgICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXJdLmNsYXNzTGlzdC5hZGQoXCJjZWxsLXNoaXAtaGl0XCIpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZWFjaEdyaWRbMF0gPT0gXCJNXCIpIHtcbiAgICAgICAgICAgIGxldCBjb29yTGluZWFyID0gcGFyc2VJbnQoaW5kZXhYKSArIHBhcnNlSW50KGluZGV4WSkgKiAxMDtcbiAgICAgICAgICAgIGdyaWRMZWZ0RE9NW2Nvb3JMaW5lYXJdLmNsYXNzTGlzdC5hZGQoXCJjZWxsLXNoaXAtbWlzc2VkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGxldCBjb21wdXRlckdyaWRQdWJsaWMgPSBjb21wdXRlci5nYW1lYm9hcmQuZ2V0UHVibGljR3JpZCgpO1xuICAgICAgY29tcHV0ZXJHcmlkUHVibGljLmZvckVhY2goKGVsZW1Sb3csIGluZGV4WCkgPT4ge1xuICAgICAgICBlbGVtUm93LmZvckVhY2goKGVhY2hHcmlkLCBpbmRleFkpID0+IHtcbiAgICAgICAgICBsZXQgY29vckxpbmVhciA9IHBhcnNlSW50KGluZGV4WCkgKyBwYXJzZUludChpbmRleFkpICogMTA7XG4gICAgICAgICAgaWYgKGVhY2hHcmlkWzBdID09IFwiSFwiKSB7XG4gICAgICAgICAgICBncmlkUmlnaHRET01bY29vckxpbmVhcl0uY2xhc3NMaXN0LmFkZChcImNlbGwtc2hpcC1oaXRcIik7XG4gICAgICAgICAgfSBlbHNlIGlmIChlYWNoR3JpZFswXSA9PSBcIk1cIikge1xuICAgICAgICAgICAgZ3JpZFJpZ2h0RE9NW2Nvb3JMaW5lYXJdLmNsYXNzTGlzdC5hZGQoXCJjZWxsLXNoaXAtbWlzc2VkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKG1vZGUgPT0gXCJoaWdobGlnaHRcIikge1xuICAgICAgZ3JpZExlZnRET00uZm9yRWFjaCgoZWxlbSkgPT5cbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKFxuICAgICAgICAgIFwiY2VsbC1ob3ZlclwiLFxuICAgICAgICAgIFwiY2VsbC1ob3Zlci1vdXRCb3VuZFwiLFxuICAgICAgICAgIFwiY2VsbC1zaGlwLWhpZ2hsaWdodC1pbnRlcmZlcmVuY2VcIixcbiAgICAgICAgICBcImNlbGwtaG92ZXItYXR0YWNrXCJcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIGdyaWRSaWdodERPTS5mb3JFYWNoKChlbGVtKSA9PlxuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAgICAgXCJjZWxsLWhvdmVyXCIsXG4gICAgICAgICAgXCJjZWxsLWhvdmVyLW91dEJvdW5kXCIsXG4gICAgICAgICAgXCJjZWxsLXNoaXAtaGlnaGxpZ2h0LWludGVyZmVyZW5jZVwiLFxuICAgICAgICAgIFwiY2VsbC1ob3Zlci1hdHRhY2tcIlxuICAgICAgICApXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAobW9kZSA9PSBcInJlbW92ZUxpc3RlbmVyXCIpIHtcbiAgICAgIGxldCBjb29yTGluZWFyID0gcGFyc2VJbnQobW91c2VDb29yLngpICsgcGFyc2VJbnQobW91c2VDb29yLnkpICogMTA7XG4gICAgICBncmlkUmlnaHRET01bY29vckxpbmVhcl0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGF0dGFja0NlbGwpO1xuICAgIH1cbiAgfTtcbiAgbGV0IHJvdGF0ZVNoaXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgbW91c2VDb29yLmRpciA9IG1vdXNlQ29vci5kaXIgPT0gXCJ4XCIgPyBcInlcIiA6IFwieFwiO1xuICAgIHJlZnJlc2goXCJoaWdobGlnaHRcIik7XG4gIH07XG4gIGxldCByb3RhdGVCdXR0b24gPSBmdW5jdGlvbiAobW9kZSkge1xuICAgIGlmIChtb2RlID09IFwib25cIikge1xuICAgICAgbGV0IHJvdGF0ZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWVzc2FnZSA+IGJ1dHRvblwiKTtcbiAgICAgIHJvdGF0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcm90YXRlU2hpcCk7XG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIGNhY2hlRE9NLFxuICAgIGNvbmZpZ3VyZSxcbiAgICBzdGFydEhpZ2hsaWdodENlbGwsXG4gICAgcm90YXRlQnV0dG9uLFxuICAgIHJlZnJlc2gsXG4gICAgcmVnaXN0ZXJQbGFjZVNoaXBDZWxsLFxuICAgIGF0dGFja0xpc3RlbmVyQ2VsbCxcbiAgfTtcbn0pKCk7XG5cbi8vIGJ1dHRvblJvdGF0ZSBjYW4gYmUgXCJhZGRcIiBvciBcImRlbFwiXG4vLyBUbyBoaWRlIHRoZSBtZXNzYWdlLCBjYWxsIHRoZSBmdW5jdGlvbiB3aXRoIGFuIGVtcHR5IHN0cmluZ1xubGV0IG1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSwgYnV0dG9uUm90YXRlKSB7XG4gIGxldCBtZXNzYWdlRE9NID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlID4gcFwiKTtcbiAgbWVzc2FnZURPTS5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAvLyBjYWxsIHRoZSBmdW5jdGlvbiB3aXRoIGFkZCB0byBhZGQgYSBidXR0b25cbiAgaWYgKGJ1dHRvblJvdGF0ZSA9PSBcImFkZFwiKSB7XG4gICAgbGV0IHJvdGF0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgcm90YXRlQnV0dG9uLnRleHRDb250ZW50ID0gXCJSb3RhdGUgU2hpcFwiO1xuICAgIGxldCBtZXNzYWdlRE9NZGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xuICAgIG1lc3NhZ2VET01kaXYuYXBwZW5kKHJvdGF0ZUJ1dHRvbik7XG4gICAgLy8gY2FsbCB0aGUgZnVuY3Rpb24gd2l0aCBkZWwgdG8gZGVsZXRlIHRoZSBidXR0b25cbiAgfSBlbHNlIGlmIChidXR0b25Sb3RhdGUgPT0gXCJkZWxcIikge1xuICAgIGxldCBtZXNzYWdlRE9NZGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xuICAgIG1lc3NhZ2VET01kaXYucmVtb3ZlQ2hpbGQobWVzc2FnZURPTWRpdi5sYXN0Q2hpbGQpO1xuICB9XG59O1xuXG5leHBvcnQgeyBnYW1lLCBodW1hbiB9O1xuIiwiaW1wb3J0IHtnYW1lfSBmcm9tIFwiLi9jb250cm9sXCJcblxuZ2FtZS5pbml0aWF0ZUdhbWUoKVxuXG4vLyBVc2VyIHN0b3JpZXMgdG8gZGV2ZWxvcFxuLy8gVTIgQWRkIGludGVsbGlnZW5jZSB0byB0aGUgY29tcHV0ZXIiXSwibmFtZXMiOlsic2hpcENsYXNzZXMiLCJnYW1lYm9hcmRGYWN0b3J5Iiwic2hpcElkQ291bnRlciIsInNoaXBMaXN0IiwiZ3JpZCIsIkFycmF5IiwiZmlsbCIsIm1hcCIsImdldFByaXZhdGVHcmlkIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwiZ2V0UHVibGljR3JpZCIsInB1YmxpY0dyaWQiLCJlbGVtZW50IiwiZWxlbSIsInBsYWNlU2hpcCIsImNvb3IiLCJzaGlwTGVuZ3RoIiwiZGlyIiwieCIsIkVycm9yIiwieSIsImkiLCJzaGlwSWQiLCJzaGlwIiwidHlwZSIsImZ1c2VsYWdlIiwiYWxsQ29vciIsImdldEZ1c2VsYWdlIiwic2V0Q29vciIsInB1c2giLCJnZXRDb29yIiwiaGl0IiwiaGl0U3VjY2VzcyIsImZvckVhY2giLCJpbmRleCIsImlzU3VuayIsImV2ZXJ5Iiwic2hpcEZhY3RvcnkiLCJhdHRhY2siLCJyZXBsYWNlIiwiZmluZCIsIml0ZW0iLCJhcnJheSIsImlzQWxsSGl0IiwicGxheWVyRmFjdG9yeSIsInNjb3JlIiwiZ2FtZWJvYXJkIiwidGhpcyIsInJlY2VpdmVIaXQiLCJMIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZXJyb3IiLCJncmlkSHVtYW4iLCJodW1hbiIsImdhbWUiLCJyb3VuZCIsImxvb3AiLCJyZWdDaGVjayIsInRlc3QiLCJjb21wdXRlciIsImN1cnJlbnRQbGF5ZXIiLCJkaXNwbGF5R3JpZCIsImNvbmZpZ3VyZSIsImNhY2hlRE9NIiwicm90YXRlQnV0dG9uIiwic3RhcnRIaWdobGlnaHRDZWxsIiwicmVnaXN0ZXJQbGFjZVNoaXBDZWxsIiwiY2hlY2tJZldvbiIsInJlZnJlc2giLCJlbmRHYW1lIiwibWVzc2FnZSIsImluaXRpYXRlR2FtZSIsInN0YXJ0R2FtZSIsImF0dGFja0xpc3RlbmVyQ2VsbCIsImdldEdyaWQiLCJwbGF5ZXIiLCJncmlkTGVmdERPTSIsImdyaWRSaWdodERPTSIsIm1vdXNlQ29vciIsIm1lc3NhZ2VzIiwic2hpcFNpemVzIiwic2hpcFNpemVJbmRleCIsInVwZGF0ZUN1cnNvciIsImUiLCJwYXJzZUludCIsInRhcmdldCIsImlkIiwiYXR0YWNrQ2VsbCIsIm1vZGUiLCJvbGRfZWxlbWVudExlZnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJuZXdfZWxlbWVudExlZnQiLCJjbG9uZU5vZGUiLCJwYXJlbnROb2RlIiwicmVwbGFjZUNoaWxkIiwib2xkX2VsZW1lbnRSaWdodCIsIm5ld19lbGVtZW50UmlnaHQiLCJlbGVtUm93IiwiaW5kZXhYIiwiZWFjaEdyaWQiLCJpbmRleFkiLCJjb29yTGluZWFyIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJvdGF0ZVNoaXAiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZ3JpZExlZnQiLCJncmlkUmlnaHQiLCJoaWdobGlnaHRDdXJzb3IiLCJodW1hbkdyaWQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVnaXN0ZXJTaGlwTG9jYXRpb24iLCJidXR0b25Sb3RhdGUiLCJpbm5lckhUTUwiLCJjcmVhdGVFbGVtZW50IiwidGV4dENvbnRlbnQiLCJhcHBlbmQiLCJtZXNzYWdlRE9NZGl2IiwicmVtb3ZlQ2hpbGQiLCJsYXN0Q2hpbGQiXSwic291cmNlUm9vdCI6IiJ9